-- ========================================
-- 数据库表重命名回滚脚本
-- ========================================
-- 说明：
-- 如果表重命名后出现问题，可以使用此脚本回滚
-- 
-- ⚠️ 警告：
-- - 仅在确认需要回滚时执行
-- - 执行前请确保已停止后端服务
-- - 执行后需要还原后端代码到修改前的版本
-- 
-- 创建时间：2025-12-09
-- ========================================

-- 设置字符集
SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ========================================
-- 1. 回滚用户表
-- ========================================
RENAME TABLE `core_users` TO `aiot_core_users`;

-- ========================================
-- 2. 回滚学校表
-- ========================================
RENAME TABLE `core_schools` TO `aiot_schools`;

-- ========================================
-- 3. 验证回滚结果
-- ========================================
-- 执行以下查询验证表是否回滚成功：
-- 
-- SHOW TABLES LIKE 'aiot_%';
-- 
-- 应该看到：
-- - aiot_core_users
-- - aiot_schools
-- 
-- 执行以下查询确认新表已不存在：
-- 
-- SHOW TABLES LIKE 'core_users';
-- SHOW TABLES LIKE 'core_schools';
-- 
-- 应该返回空结果

SET FOREIGN_KEY_CHECKS = 1;

-- ========================================
-- 回滚后操作：
-- ========================================
-- 1. 使用 git 还原后端代码到修改前的版本
--    cd /path/to/backend
--    git checkout <commit-hash> -- app/models/
-- 
-- 2. 重启后端服务
-- 
-- 3. 测试功能确认正常
-- ========================================
